#!/bin/bash

superclusters=GCF_000012725_000000000001_gene_clusters.csv
genomes=@("GCF_000013885","GCA_001897285","GCF_002028545","GCF_000152905","GCF_000012725","GCA_001896955","GCF_006539545" )
dir=$(echo pwd)
outputs=@()

cur_acc=@()
cur_starts=@()
cur_names=@()
while read -r line; do
	acc=line.split(',')[4]
	start=line.split(',')[0]
	name=lien.split(',')[3]
	if cur_acc is empty:
		cur_acc.append(acc)
		cur_starts.append(start)
		cur_names.append(name)
		continue
	if acc-5 <= cur_acc[-1]:
		cur_acc.append(acc)
                cur_starts.append(start)
                cur_names.append(name)
                continue
	if len(cur_acc) >= 2:
		start=cur_start[0] - 2000
		stop=cur_start[-1] + 3000
		if start < 0:
			start=0
		output=@(@("GCF_000012725_000000000001",$start,$stop))
		for $gnome in $genomes:
			for file in "{$gnome}*.csv"
				c_starts=@()
				contig=basename("{$dir}/{$file}" "_gene_clusters.csv")
				for $name in $cur_names:
					line=$(grep $name $file)
					if line:
						c_starts.append(line.split(',)[3]
				if_ c_starts != ():
					start=min(c_starts) -2000
					if start < 0:
						start= 0
					end= max(c_starts) + 3000
					output.append(@($contig, $start, $stop)
		outputs.append($output)
done < $superclusters

for op in $outputs:
	echo $op >> "extract_this.txt"

